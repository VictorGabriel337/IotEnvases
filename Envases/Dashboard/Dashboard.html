<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="Dashboard.css" rel="stylesheet" />
    <title>Dashboard</title>
</head>
<body>
    <video autoplay muted loop id="videoBG">
        <source src="video/videoplayback.mp4" type="video/mp4">
      </video> 

      <iframe class="sidebar-iframe" scrolling="no" src="../sidebar/Sidebar.html"></iframe>

    <div class="main">
        
        <div class="primeira-coluna">

            <div class="definir">
                <h3 class="text1">Produto</h3>
                <div class="icon-img"> <img src="img/silhueta-garrafa.png"></div>
                <select id="produtoSelect">
                    <option value="card-coca/coca.html">Coca-cola original</option>
                    <option value="card-coca/zero.html">Coca-cola zero</option>
                    <option value="card-coca/fanta.html">Bi Fanta</option>
                    <option value="garrafa sem rotulo">Garrafa sem rotulo</option>
                </select>
            </div>
            <div class="definir">
                <h3 class="text1">Garrafa produzida</h3>
                <div class="icon-img"> <img src="img/silhueta-garrafa.png"></div>
                <p id="lowCount" class="sensorlow">Carregando...</p>  <!-- Aqui será exibido o valor de lastLowTime -->
            </div>
            <div class="definir">
                <h3 class="text1">Maq. Parada</h3>
                <div class="icon-img"> <img src="img/silhueta-garrafa.png"></div>
                <p id="maqParada" class="sensorlow">Carregando...</p>
            </div>
            <div class="definir">
                <h3 class="text1">Maq. Produzindo</h3>
                <div class="icon-img"> <img src="img/silhueta-garrafa.png"></div>
                <p id="maqProduzindo" class="sensorlow">Carregando...</p>
            </div>
        </div>

        <div class="segunda-coluna">
            <div class="prim-coluna">
                <iframe id="produtoIframe" class="coca-iframe" scrolling="no" src="card-coca/coca.html"></iframe>
                <!-- <iframe class="coca-iframe" scrolling="no" src="card-coca/coca.html"></iframe>
                <iframe class="coca-iframe" scrolling="no" src="card-coca/fanta.html"></iframe>
                <iframe class="coca-iframe" scrolling="no" src="card-coca/zero.html"></iframe> -->
            </div>
            <div class="seg-coluna"></div>
            <div class="ter-coluna"></div>
        </div>

        <div class="terceira-coluna">

            <div class="first-column"></div>
            <div class="second-column"></div>


        </div>

        <div class="quarta-coluna"> 
            <div class="coluna-um"></div>
            <div class="coluna-dois"></div>
        </div>


    </div> <!--div main-->

    <script>
        // Captura os elementos
        const selectElement = document.getElementById('produtoSelect');
        const iframeElement = document.getElementById('produtoIframe');

        // Adiciona um evento para monitorar mudanças no select
        selectElement.addEventListener('change', function() {
            const selectedValue = this.value; // Pega o valor selecionado
            iframeElement.src = selectedValue; // Atualiza o src do iframe




        });

</script>

<script>
    function formatarTempo(segundos) {
        const minutos = Math.floor(segundos / 60);
        const restoSegundos = segundos % 60;
        const segundosFormatado = restoSegundos.toString().padStart(2, '0');
        return `${minutos}m ${segundosFormatado}s`;
    }

</script>
<script>
   // Configurações
const backendURL = "https://iotenvases.onrender.com/sensores"; // Substitua pelo seu URL
const updateInterval = 2000; // 2 segundos
let isLoading = false;

// Elementos da UI
const elements = {
    lowCount: document.getElementById("lowCount"),
    maqProduzindo: document.getElementById("maqProduzindo"),
    maqParada: document.getElementById("maqParada"),
    statusIndicator: document.createElement("div") // Criando elemento de status
};

// Adiciona o indicador de status ao DOM
elements.statusIndicator.className = "status-indicator";
document.body.appendChild(elements.statusIndicator);

// Função para formatar o tempo (MM:SS)
function formatarTempo(segundos) {
    if (isNaN(segundos)) return "0m 00s";
    const minutos = Math.floor(segundos / 60);
    const segs = segundos % 60;
    return `${minutos}m ${segs.toString().padStart(2, '0')}s`;
}

// Atualiza a UI com os dados recebidos
function updateUI(data) {
    console.log("Atualizando UI com:", data);
    
    // Verifica se os dados são válidos
    const isValidData = data && 
                      data.lowSignalCount !== undefined && 
                      data.cadenceTotalTime !== undefined && 
                      data.nonCadenceTotalTime !== undefined;
    
    if (isValidData) {
        elements.lowCount.textContent = data.lowSignalCount;
        elements.maqProduzindo.textContent = formatarTempo(data.cadenceTotalTime);
        elements.maqParada.textContent = formatarTempo(data.nonCadenceTotalTime);
        
        // Atualiza o status
        updateStatusIndicator("success", "Dados atualizados");
        
        // Animação de atualização
        animateElements();
    } else {
        updateStatusIndicator("warning", "Dados parciais recebidos");
    }
}

// Animação dos elementos
function animateElements() {
    const elementsToAnimate = [elements.lowCount, elements.maqProduzindo, elements.maqParada];
    
    elementsToAnimate.forEach(el => {
        el.classList.add('updated');
        setTimeout(() => el.classList.remove('updated'), 500);
    });
}

// Atualiza o indicador de status
function updateStatusIndicator(type, message) {
    elements.statusIndicator.textContent = message;
    elements.statusIndicator.className = `status-indicator ${type}`;
    
    // Remove o status após 3 segundos
    setTimeout(() => {
        elements.statusIndicator.textContent = "";
        elements.statusIndicator.className = "status-indicator";
    }, 3000);
}

// Busca dados do backend
async function fetchSensorData() {
    if (isLoading || !navigator.onLine) return;
    isLoading = true;
    
    try {
        updateStatusIndicator("info", "Atualizando dados...");
        
        const timestamp = Date.now(); // Para evitar cache
        const response = await fetch(`${backendURL}?t=${timestamp}`);
        
        if (!response.ok) {
            throw new Error(`Erro HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        console.log("Dados recebidos:", data);
        
        updateUI(data);
    } catch (error) {
        console.error("Erro ao buscar dados:", error);
        updateStatusIndicator("error", "Erro ao carregar dados");
        
        // Mostra valores padrão em caso de erro
        elements.lowCount.textContent = "---";
        elements.maqProduzindo.textContent = "---";
        elements.maqParada.textContent = "---";
    } finally {
        isLoading = false;
    }
}

// Verifica conexão periodicamente
function checkConnection() {
    if (!navigator.onLine) {
        updateStatusIndicator("error", "Sem conexão com a internet");
    }
}

// Inicialização
function init() {
    console.log("Inicializando dashboard...");
    
    // Carrega os dados imediatamente
    fetchSensorData();
    
    // Configura atualização periódica
    setInterval(fetchSensorData, updateInterval);
    
    // Verifica conexão a cada 5 segundos
    setInterval(checkConnection, 5000);
    
    // Evento para recarregar quando a conexão voltar
    window.addEventListener('online', fetchSensorData);
}

// Inicia quando o DOM estiver carregado
document.addEventListener('DOMContentLoaded', init);
</script>




    
</body>
</html>